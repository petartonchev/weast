{% extends "base.html" %}
{% block content %}
  <div class="row show-sentiment">
    <div class="col-md-6 mt-4 float-left">
      <div class="col-md-12">
        <h1 class="display-6 text-light text-center mt-5">{{ stock }}</h1>
      </div>
      <div class="col-md-12 pt-2">
        {% if sentiment >= 0.15 %}
          <img class="emoji m-3 mx-auto" src="/static/images/positive.png" alt="">
        {% elif sentiment > -0.15 %}
          <img class="emoji m-3 float-center mx-auto" src="/static/images/neutral.png" alt="">
        {% else %}
          <img class="emoji m-3 align-middle mx-auto" src="/static/images/negative.png" alt="">
        {% endif %}
      </div>
      <div class="col-md-12">
        <h1 class="display-7 text-light text-center mt-5">Overall sentiment: {{ sentiment|floatformat:"2" }}</h1>
      </div>
      <div class="col-md-12 pt-4 charts">
        <div class="card small bg-light  shadow rounded mt-5 border-0 ">
          <div class="card-header border-0 pt-3 lead text-dark">

          </div>
          <div class="card-body">
            <div id="test"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6 tweets mt-4 float-right">

      <div class="card small bg-light  shadow rounded mt-5 border-0">
        <div class="card-header border-0 pt-3 lead text-dark">
          Tweets:
        </div>
        <div class="card-body">
          {% for tweet in tweets|dictsortreversed:"retweets" %}
            <div class="row ">
              <div class="col-md-6">
                <p class="lead text-muted">{{ tweet.username|capfirst }}</p>
              </div>
              <div class="col-md-6">
                <p class="text-muted float-right info">Sentiment: {{ tweet.sentiment|floatformat:"2" }}</p>
              </div>
              <div class="col-md-12 pb-2">
                {{ tweet.text }}
              </div>
              <div class="col-md-6">
                <p class="text-muted info mb-0">Retweets: {{ tweet.retweets }}</p>
              </div>
              <div class="col-md-6 pb-1">
                <p class="text-muted float-right info mb-0">{{ tweet.created_at|date:"d, M, Y P" }}</p>
              </div>
              <div class="col-md-12 mb-4 divider border-bottom"></div>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
  <script>
    Highcharts.chart('test', {
      chart: {
        zoomType: 'x'
      },
      title: {
        text: 'Real Stock Price vs Sentiment over Time'
      },
      subtitle: {
        text: document.ontouchstart === undefined ?
          'Click and drag in the plot area to zoom in' : 'Pinch the chart to zoom in'
      },
      xAxis: {
        type: 'datetime'
      },
      yAxis: [{ // Primary yAxis
        labels: {
          format: '{value}$',
          style: {
            color: Highcharts.getOptions().colors[0]
          }
        },
        title: {
          text: 'Adj Close',
          style: {
            color: Highcharts.getOptions().colors[0]
          }
        }
      }, { // Secondary yAxis
        max: 1,
        min: -1,
        endOnTick: false,
        title: {
          text: 'Sentiment',
          style: {
            color: '#4c9d49'
          }
        },
        labels: {
          style: {
            color: '#4c9d49'
          }
        },
        opposite: true
      }],
      legend: {
        enabled: false
      },
      plotOptions: {
        area: {
          fillColor: {
            linearGradient: {
              x1: 0,
              y1: 0,
              x2: 0,
              y2: 1
            },
            stops: [
              [0, Highcharts.getOptions().colors[0]],
              [1, Highcharts.Color(Highcharts.getOptions().colors[0]).setOpacity(0).get('rgba')]
            ]
          },
          marker: {
            radius: 2
          },
          lineWidth: 1,
          states: {
            hover: {
              lineWidth: 1
            }
          },
          threshold: null
        },
        column: {

          opacity: 0.7,
          zones: [{
            value: 0,
            color: '#f60239'
          }, {
            color: '#4c9d49'
          }]
        }
      },

      series: [{
        type: 'area',
        name: 'USD to EUR',
        data: {{ price_trend }}
      }, {
        type: 'column',
        name: 'Twitter Sentiment',
        yAxis: 1,
        data: {{ sentiment_trend }}
      }]
    });

  </script>
{% endblock content %}
